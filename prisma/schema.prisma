generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["jsonProtocol"]
}

datasource db {
  provider          = "postgresql"
  url               = env("POSTGRES_PRISMA_URL")
  directUrl         = env("POSTGRES_URL_NON_POOLING")
  shadowDatabaseUrl = env("POSTGRES_URL_NON_POOLING")
}

model Bandwidth {
  id                                    Int      @id @default(autoincrement())
  time                                  DateTime @default(now()) @db.Timestamptz
  serverId                              Int
  appId                                 Int
  // HTTP User bandwidth send by country
  TotalBandwidthByCountry_Vietnam       BigInt   @default(0)
  TotalBandwidthByCountry_US            BigInt   @default(0)
  TotalBandwidthByCountry_Myanmar       BigInt   @default(0)
  TotalBandwidthByCountry_International BigInt   @default(0)
  TotalBandwidthByCountry_Other         BigInt   @default(0)
  TotalBandwidthByCountry_Notfound      BigInt   @default(0)
  // HTTP User bandwidth send by ISP
  TotalBandwidthByIsp_Viettel           BigInt   @default(0)
  TotalBandwidthByIsp_Mobi              BigInt   @default(0)
  TotalBandwidthByIsp_Vina              BigInt   @default(0)
  TotalBandwidthByIsp_FPT               BigInt   @default(0)
  TotalBandwidthByIsp_Other             BigInt   @default(0)
  TotalBandwidthByIsp_Unknown           BigInt   @default(0)
  // HTTP User bandwidth
  TotalBandwidthReceiveClientHTTP       BigInt   @default(0)
  TotalBandwidthSendClientHTTP          BigInt   @default(0)
  TotalBandwidthReceiveClientHTTP2      BigInt   @default(0)
  TotalBandwidthSendClientHTTP2         BigInt   @default(0)
  // 
  TotalBandwidthReceiveClientHTTPS      BigInt   @default(0)
  TotalBandwidthSendClientHTTPS         BigInt   @default(0)
  // Download bandwidth
  TotalBandwidthReceiveDownload         BigInt   @default(0)
  TotalBandwidthSendDownload            BigInt   @default(0)
}

// Tab HTTPS Bandwidth
model HTTPSBandwidth {
  id                                             Int      @id @default(autoincrement())
  time                                           DateTime @default(now()) @db.Timestamptz
  serverId                                       Int
  appId                                          Int
  // TotalBandwidthSendClientHTTPS
  TotalBandwidthSendHTTPS_Outbound               BigInt   @default(0)
  // TotalBandwidthReceiveClientHTTPS
  TotalBandwidthRecvHTTPS_Inbound                BigInt   @default(0)
  // TotalBandwidthByCountry
  TotalBandwidthSendHTTPSByCountry_Vietnam       BigInt   @default(0)
  TotalBandwidthSendHTTPSByCountry_US            BigInt   @default(0)
  TotalBandwidthSendHTTPSByCountry_Myanmar       BigInt   @default(0)
  TotalBandwidthSendHTTPSByCountry_International BigInt   @default(0)
  TotalBandwidthSendHTTPSByCountry_Other         BigInt   @default(0)
  TotalBandwidthSendHTTPSByCountry_NotFound      BigInt   @default(0)
  // TotalBandwidthByIsp
  TotalBandwidthSendHTTPSByIsp_Viettel           BigInt   @default(0)
  TotalBandwidthSendHTTPSByIsp_Mobi              BigInt   @default(0)
  TotalBandwidthSendHTTPSByIsp_Vina              BigInt   @default(0)
  TotalBandwidthSendHTTPSByIsp_FPT               BigInt   @default(0)
  TotalBandwidthSendHTTPSByIsp_Other             BigInt   @default(0)
  TotalBandwidthSendHTTPSByIsp_Unknown           BigInt   @default(0)
  // 
  DataUsageSendHTTPS_Outbound                    BigInt   @default(0)
  DataUsageRecvHTTPS_Inbound                     BigInt   @default(0)
  // 
  DataUsageHTTPSByCountry_Vietnam                BigInt   @default(0)
  DataUsageHTTPSByCountry_US                     BigInt   @default(0)
  DataUsageHTTPSByCountry_Myanmar                BigInt   @default(0)
  DataUsageHTTPSByCountry_International          BigInt   @default(0)
  DataUsageHTTPSByCountry_Other                  BigInt   @default(0)
  DataUsageHTTPSByCountry_NotFound               BigInt   @default(0)
  // 
  DataUsageSendHTTPSByIsp_Viettel                BigInt   @default(0)
  DataUsageHTTPSByIsp_Mobi                       BigInt   @default(0)
  DataUsageHTTPSByIsp_Vina                       BigInt   @default(0)
  DataUsageHTTPSByIsp_FPT                        BigInt   @default(0)
  DataUsageHTTPSByIsp_Other                      BigInt   @default(0)
  DataUsageHTTPSByIsp_Unknown                    BigInt   @default(0)
}

// Tab HTTP2 Bandwidth
model HTTP2Bandwidth {
  id                                             Int      @id @default(autoincrement())
  time                                           DateTime @default(now()) @db.Timestamptz
  serverId                                       Int
  appId                                          Int
  // TotalBandwidthSendClientHTTP2
  TotalBandwidthSendHTTP2_Outbound               BigInt   @default(0)
  // TotalBandwidthReceiveClientHTTP2
  TotalBandwidthRecvHTTP2_Inbound                BigInt   @default(0)
  // TotalBandwidthByCountry
  TotalBandwidthSendHTTP2ByCountry_Vietnam       BigInt   @default(0)
  TotalBandwidthSendHTTP2ByCountry_US            BigInt   @default(0)
  TotalBandwidthSendHTTP2ByCountry_Myanmar       BigInt   @default(0)
  TotalBandwidthSendHTTP2ByCountry_International BigInt   @default(0)
  TotalBandwidthSendHTTP2ByCountry_Other         BigInt   @default(0)
  TotalBandwidthSendHTTP2ByCountry_NotFound      BigInt   @default(0)
  // TotalBandwidthByIsp
  TotalBandwidthSendHTTP2ByIsp_Viettel           BigInt   @default(0)
  TotalBandwidthSendHTTP2ByIsp_Mobi              BigInt   @default(0)
  TotalBandwidthSendHTTP2ByIsp_Vina              BigInt   @default(0)
  TotalBandwidthSendHTTP2ByIsp_FPT               BigInt   @default(0)
  TotalBandwidthSendHTTP2ByIsp_Other             BigInt   @default(0)
  TotalBandwidthSendHTTP2ByIsp_Unknown           BigInt   @default(0)
  // 
  TotalDataUsageSendHTTP2_Outbound               BigInt   @default(0)
  TotalDataUsageRecvHTTP2_Inbound                BigInt   @default(0)
  // 
  TotalDataUsageHTTP2ByCountry_Vietnam           BigInt   @default(0)
  TotalDataUsageHTTP2ByCountry_US                BigInt   @default(0)
  TotalDataUsageHTTP2ByCountry_Myanmar           BigInt   @default(0)
  TotalDataUsageHTTP2ByCountry_International     BigInt   @default(0)
  TotalDataUsageHTTP2ByCountry_Other             BigInt   @default(0)
  TotalDataUsageHTTP2ByCountry_NotFound          BigInt   @default(0)
  // 
  TotalDataUsageHTTP2ByIsp_Viettel               BigInt   @default(0)
  TotalDataUsageHTTP2ByIsp_Mobi                  BigInt   @default(0)
  TotalDataUsageHTTP2ByIsp_Vina                  BigInt   @default(0)
  TotalDataUsageHTTP2ByIsp_FPT                   BigInt   @default(0)
  TotalDataUsageHTTP2ByIsp_Other                 BigInt   @default(0)
  TotalDataUsageHTTP2ByIsp_Unknown               BigInt   @default(0)
}

// Tab Cache
model Cache {
  id                    Int      @id @default(autoincrement())
  time                  DateTime @default(now()) @db.Timestamptz
  serverId              Int
  appId                 Int
  PercentMemHitTotal    BigInt   @default(0)
  PercentDiskHitTotal   BigInt   @default(0)
  // Calculate by PercentMemHit and PercentDiskHit
  PercentMissCacheTotal BigInt   @default(0)
  TotalMemHit           BigInt   @default(0)
  TotalDiskHit          BigInt   @default(0)
  TotalRequestHTTP      BigInt   @default(0)
  TotalRequestHTTPS     BigInt   @default(0)
  TotalRequestHTTP2     BigInt   @default(0)
}

// Tab Download
model Download {
  id                                    Int      @id @default(autoincrement())
  time                                  DateTime @default(now()) @db.Timestamptz
  serverId                              Int
  appId                                 Int
  TotalConnDownload                     BigInt   @default(0)
  TotalRequestDownload                  BigInt   @default(0)
  TotalRequestDownloadRetry             BigInt   @default(0)
  TotalCCUDownload                      BigInt   @default(0)
  TotalCCURequestDownload               BigInt   @default(0)
  RecentTimeDownload                    BigInt   @default(0) // getRecentTimeDownload
  ConnPoolsDownload_PoolSize            BigInt   @default(0) // poolSize
  ConnPoolsDownload_MaxPoolSize         BigInt   @default(0) // maxPoolSize
  ConnPoolsDownload_TotalBorrow         BigInt   @default(0) // totalBorowPoolDown
  ConnPoolsDownload_TotalInvalid        BigInt   @default(0) // totalInvalidPoolDown
  ConnPoolsDownload_TotalConnectFailed  BigInt   @default(0) // totalConnFailPoolDown
  ConnPoolsDownload_TotalConnectSuccess BigInt   @default(0) // totalConnSuccessPoolDown
}

// Tab Internal download
model InternalDownload {
  id                                    Int      @id @default(autoincrement())
  time                                  DateTime @default(now()) @db.Timestamptz
  serverId                              Int
  appId                                 Int
  TotalRequestDownloadInternal          BigInt   @default(0) // getTotalRequestDownloadInternal
  TotalRequestDownloadInternalRetry     BigInt   @default(0) // getTotalRequestDownloadInternalRetry
  TotalCCURequestDownloadInternal       BigInt   @default(0) // getTotalCCURequestDownloadInternal
  TotalCCUDownloadInternal              BigInt   @default(0) // getTotalCCUDownloadInternal
  TotalCloseDownloadInternal            BigInt   @default(0) // getTotalCloseDownloadInternal
  TotalConnDownloadInternal             BigInt   @default(0) // getTotalConnDownloadInternal
  RecentTimeDownloadInternal            BigInt   @default(0) // getRecentTimeDownloadInternal
  TotalBandwidthReceiveDownloadInternal BigInt   @default(0) // getTotalBandwidthReceiveDownloadInternal
  TotalBandwidthSendDownloadInternal    BigInt   @default(0) // getTotalBandwidthSendDownloadInternal
  TotalBandwidthReceiveClientInternal   BigInt   @default(0) // getTotalBandwidthReceiveClientInternal
  TotalBandwidthSendClientInternal      BigInt   @default(0) // getTotalBandwidthSendClientInternal
}

// Tab Overlay download
// Empty chart

model HTTPStatusCode {
  id           Int      @id @default(autoincrement())
  time         DateTime @default(now()) @db.Timestamptz
  serverId     Int
  appId        Int
  Total200     BigInt   @default(0) // getTotal200
  Total301     BigInt   @default(0) // getTotal301
  Total302     BigInt   @default(0) // getTotal302
  Total304     BigInt   @default(0) // getTotal304
  Total400     BigInt   @default(0) // getTotal400
  Total403     BigInt   @default(0) // getTotal403
  Total404     BigInt   @default(0) // getTotal404
  Total500     BigInt   @default(0) // getTotal500
  Total502     BigInt   @default(0) // getTotal502
  TotalClose   BigInt   @default(0) // getTotalClose
  TotalUnknown BigInt   @default(0) // getTotalUnknown
}

// Tab HTTP - HTTP2 ErrorCode
model HTTP2ErrorCode {
  id                        Int      @id @default(autoincrement())
  time                      DateTime @default(now()) @db.Timestamptz
  serverId                  Int
  appId                     Int
  TotalRcvProtocolError     BigInt   @default(0) // getTotalRcvProtocolError
  TotalRcvCancel            BigInt   @default(0) // getTotalRcvCancel
  TotalRcvCompressionError  BigInt   @default(0) // getTotalRcvCompressionError
  TotalRcvFlowControlError  BigInt   @default(0) // getTotalRcvFlowControlError
  TotalRcvFrameSizeError    BigInt   @default(0) // getTotalRcvFrameSizeError
  TotalRcvInternalError     BigInt   @default(0) // getTotalRcvInternalError
  TotalRcvRefusedStream     BigInt   @default(0) // getTotalRcvRefusedStream
  TotalRcvSettingTimeout    BigInt   @default(0) // getTotalRcvSettingTimeout
  TotalRcvStreamClose       BigInt   @default(0) // getTotalRcvStreamClose
  TotalSendProtocolError    BigInt   @default(0) // getTotalSendProtocolError
  TotalSendCancel           BigInt   @default(0) // getTotalSendCancel
  TotalSendCompressionError BigInt   @default(0) // getTotalSendCompressionError
  TotalSendFlowControlError BigInt   @default(0) // getTotalSendFlowControlError
  TotalSendFrameSizeError   BigInt   @default(0) // getTotalSendFrameSizeError
  TotalSendInternalError    BigInt   @default(0) // getTotalSendInternalError
  TotalSendRefusedStream    BigInt   @default(0) // getTotalSendRefusedStream
  TotalSendSettingTimeout   BigInt   @default(0) // getTotalSendSettingTimeout
  TotalSendStreamClose      BigInt   @default(0) // getTotalSendStreamClose
}

// Tab response
// Empty chart

// Tab connection
model Connection {
  id                     Int      @id @default(autoincrement())
  time                   DateTime @default(now()) @db.Timestamptz
  serverId               Int
  appId                  Int
  RespondConnsCliHTTP    BigInt   @default(0)
  RespondConnsCliHTTPS   BigInt   @default(0)
  RespondConnsCliHTTP2   BigInt   @default(0)
  KeepAliveConnsCliHTTP  BigInt   @default(0)
  KeepAliveConnsCliHTTPS BigInt   @default(0)
  KeepAliveConnsCliHTTP2 BigInt   @default(0)
  KeepAliveConnsDownload BigInt   @default(0)
}
